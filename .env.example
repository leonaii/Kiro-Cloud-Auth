# Kiro-Cloud-Auth  - 环境变量配置
# 复制此文件为 .env 并修改配置

# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USER=open_ai
DB_PASSWORD=your_password
DB_NAME=open_kiro_db

# 服务配置
SERVER_ID=server-1

# OpenAI 兼容 API 默认授权密钥
DEFAULT_API_KEY=Alf123456

# Web 后台登录密码（留空则不启用登录验证）
WEB_LOGIN_PASSWORD=admin123

# Electron 客户端认证密钥（用于 HMAC 签名验证）
ELECTRON_AUTH_SECRET=kiro-electron-secret-2024-leon

# ============ 性能调优（12核12G 服务器推荐配置）============

# 数据库连接池大小（默认 100，高并发可设 200）
DB_POOL_SIZE=100

# 集群 Worker 数量（默认使用全部 CPU 核心，12核设 12）
CLUSTER_WORKERS=12

# Redis 配置（可选，用于多实例共享账号池）
REDIS_HOST=localhost
REDIS_PORT=6379

# 禁用 Token 自动刷新（多实例部署时只需一个实例开启）
# DISABLE_TOKEN_REFRESH=true

# 是否在刷新 Token 时自动绑定机器码（默认 false）
# 设为 true 时，如果账号没有绑定机器码，会自动创建并绑定
# 设为 false（默认）时，只刷新已绑定机器码的账号，未绑定的账号会被跳过
AUTO_BIND_MACHINE_ID=false

# 是否在刷新 Token 后自动刷新账号的使用量和订阅信息（默认 false）
# 设为 true 时，Token 刷新成功后会等待 1-3 秒，然后自动调用 API 获取最新的使用量和订阅信息
# 设为 false（默认）时，只刷新 Token，不获取使用量信息
AUTO_REFRESH_USAGE_AFTER_TOKEN=false

DEFAULT_HEADER_VERSION=2

# ============ 活跃池/冷却池配置 ============

# 是否启用活跃池机制（默认 true）
# 启用后，系统会维护一个固定大小的活跃账号池，只从活跃池中选择账号处理请求
# 禁用后，使用传统的全局轮询方式
ACTIVE_POOL_ENABLED=true

# 活跃池上限（默认 5）
# 活跃池中最多保持的账号数量，建议根据并发量设置
ACTIVE_POOL_LIMIT=5

# 异常累计阈值（默认 5）
# 当活跃池中的账号累计错误次数达到此阈值时，会被移入冷却池
ACTIVE_POOL_ERROR_THRESHOLD=5

# 冷却时间（毫秒，默认 600000 = 10 分钟）
# 账号在冷却池中需要等待的时间，超过后会检查是否可以恢复到活跃池
ACTIVE_POOL_COOLING_PERIOD_MS=600000

# Token 刷新是否只针对活跃池账号（默认 true）
# 设为 true 时，只刷新活跃池中账号的 Token
# 设为 false 时，刷新所有即将过期的账号 Token
TOKEN_REFRESH_ACTIVE_POOL_ONLY=true

# ============ Claude API 配置 ============

# 是否启用 Claude 兼容 API（默认 true）
# 设为 false 可禁用 Claude API，只保留 OpenAI 兼容 API
# 如果 Claude API 导致问题，可以临时禁用
ENABLE_CLAUDE_API=true
